{"version":3,"sources":["../../../src/hooks/useCollector.ts"],"sourcesContent":["import equal from 'fast-deep-equal'\nimport { useState, useCallback } from 'react'\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect.js'\n\n/**\n *\n * @param monitor The monitor to collect state from\n * @param collect The collecting function\n * @param onUpdate A method to invoke when updates occur\n */\nexport function useCollector<T, S>(\n\tmonitor: T,\n\tcollect: (monitor: T) => S,\n\tonUpdate?: () => void,\n): [S, () => void] {\n\tconst [collected, setCollected] = useState(() => collect(monitor))\n\n\tconst updateCollected = useCallback(() => {\n\t\tconst nextValue = collect(monitor)\n\t\t// This needs to be a deep-equality check because some monitor-collected values\n\t\t// include XYCoord objects that may be equivalent, but do not have instance equality.\n\t\tif (!equal(collected, nextValue)) {\n\t\t\tsetCollected(nextValue)\n\t\t\tif (onUpdate) {\n\t\t\t\tonUpdate()\n\t\t\t}\n\t\t}\n\t}, [collected, monitor, onUpdate])\n\n\t// update the collected properties after react renders.\n\t// Note that the \"Dustbin Stress Test\" fails if this is not\n\t// done when the component updates\n\tuseIsomorphicLayoutEffect(updateCollected)\n\n\treturn [collected, updateCollected]\n}\n"],"names":["equal","useState","useCallback","useIsomorphicLayoutEffect","useCollector","monitor","collect","onUpdate","collected","setCollected","updateCollected","nextValue"],"mappings":"AAAA,MAAM,CAACA,KAAK,MAAM,CAAiB;AACnC,MAAM,GAAGC,QAAQ,EAAEC,WAAW,QAAQ,CAAO;AAC7C,MAAM,GAAGC,yBAAyB,QAAQ,CAAgC;AAE1E,EAKG,AALH;;;;;CAKG,AALH,EAKG,CACH,MAAM,UAAUC,YAAY,CAC3BC,OAAU,EACVC,OAA0B,EAC1BC,QAAqB,EACH,CAAC;IACnB,KAAK,EAAEC,SAAS,EAAEC,YAAY,IAAIR,QAAQ,KAAOK,OAAO,CAACD,OAAO;;IAEhE,KAAK,CAACK,eAAe,GAAGR,WAAW,KAAO,CAAC;QAC1C,KAAK,CAACS,SAAS,GAAGL,OAAO,CAACD,OAAO;QACjC,EAA+E,AAA/E,6EAA+E;QAC/E,EAAqF,AAArF,mFAAqF;QACrF,EAAE,GAAGL,KAAK,CAACQ,SAAS,EAAEG,SAAS,GAAG,CAAC;YAClCF,YAAY,CAACE,SAAS;YACtB,EAAE,EAAEJ,QAAQ,EAAE,CAAC;gBACdA,QAAQ;YACT,CAAC;QACF,CAAC;IACF,CAAC,EAAE,CAACC;QAAAA,SAAS;QAAEH,OAAO;QAAEE,QAAQ;IAAA,CAAC;IAEjC,EAAuD,AAAvD,qDAAuD;IACvD,EAA2D,AAA3D,yDAA2D;IAC3D,EAAkC,AAAlC,gCAAkC;IAClCJ,yBAAyB,CAACO,eAAe;IAEzC,MAAM,CAAC,CAACF;QAAAA,SAAS;QAAEE,eAAe;IAAA,CAAC;AACpC,CAAC"}