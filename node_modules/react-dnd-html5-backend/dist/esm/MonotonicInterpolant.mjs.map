{"version":3,"sources":["../../src/MonotonicInterpolant.ts"],"sourcesContent":["export class MonotonicInterpolant {\n\tprivate xs: any\n\tprivate ys: any\n\tprivate c1s: any\n\tprivate c2s: any\n\tprivate c3s: any\n\n\tpublic constructor(xs: number[], ys: number[]) {\n\t\tconst { length } = xs\n\n\t\t// Rearrange xs and ys so that xs is sorted\n\t\tconst indexes = []\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tindexes.push(i)\n\t\t}\n\t\tindexes.sort((a, b) => ((xs[a] as number) < (xs[b] as number) ? -1 : 1))\n\n\t\t// Get consecutive differences and slopes\n\t\tconst dys = []\n\t\tconst dxs = []\n\t\tconst ms = []\n\t\tlet dx\n\t\tlet dy\n\t\tfor (let i = 0; i < length - 1; i++) {\n\t\t\tdx = (xs[i + 1] as number) - (xs[i] as number)\n\t\t\tdy = (ys[i + 1] as number) - (ys[i] as number)\n\t\t\tdxs.push(dx)\n\t\t\tdys.push(dy)\n\t\t\tms.push(dy / dx)\n\t\t}\n\n\t\t// Get degree-1 coefficients\n\t\tconst c1s = [ms[0]]\n\t\tfor (let i = 0; i < dxs.length - 1; i++) {\n\t\t\tconst m2 = ms[i] as number\n\t\t\tconst mNext = ms[i + 1] as number\n\t\t\tif (m2 * mNext <= 0) {\n\t\t\t\tc1s.push(0)\n\t\t\t} else {\n\t\t\t\tdx = dxs[i] as number\n\t\t\t\tconst dxNext = dxs[i + 1] as number\n\t\t\t\tconst common = dx + dxNext\n\t\t\t\tc1s.push(\n\t\t\t\t\t(3 * common) / ((common + dxNext) / m2 + (common + dx) / mNext),\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\t\tc1s.push(ms[ms.length - 1])\n\n\t\t// Get degree-2 and degree-3 coefficients\n\t\tconst c2s = []\n\t\tconst c3s = []\n\t\tlet m\n\t\tfor (let i = 0; i < c1s.length - 1; i++) {\n\t\t\tm = ms[i] as number\n\t\t\tconst c1 = c1s[i] as number\n\t\t\tconst invDx = 1 / (dxs[i] as number)\n\t\t\tconst common = c1 + (c1s[i + 1] as number) - m - m\n\t\t\tc2s.push((m - c1 - common) * invDx)\n\t\t\tc3s.push(common * invDx * invDx)\n\t\t}\n\n\t\tthis.xs = xs\n\t\tthis.ys = ys\n\t\tthis.c1s = c1s\n\t\tthis.c2s = c2s\n\t\tthis.c3s = c3s\n\t}\n\n\tpublic interpolate(x: number): number {\n\t\tconst { xs, ys, c1s, c2s, c3s } = this\n\n\t\t// The rightmost point in the dataset should give an exact result\n\t\tlet i = xs.length - 1\n\t\tif (x === xs[i]) {\n\t\t\treturn ys[i]\n\t\t}\n\n\t\t// Search for the interval x is in, returning the corresponding y if x is one of the original xs\n\t\tlet low = 0\n\t\tlet high = c3s.length - 1\n\t\tlet mid\n\t\twhile (low <= high) {\n\t\t\tmid = Math.floor(0.5 * (low + high))\n\t\t\tconst xHere = xs[mid]\n\t\t\tif (xHere < x) {\n\t\t\t\tlow = mid + 1\n\t\t\t} else if (xHere > x) {\n\t\t\t\thigh = mid - 1\n\t\t\t} else {\n\t\t\t\treturn ys[mid]\n\t\t\t}\n\t\t}\n\t\ti = Math.max(0, high)\n\n\t\t// Interpolate\n\t\tconst diff = x - xs[i]\n\t\tconst diffSq = diff * diff\n\t\treturn ys[i] + c1s[i] * diff + c2s[i] * diffSq + c3s[i] * diff * diffSq\n\t}\n}\n"],"names":["MonotonicInterpolant","interpolate","x","xs","ys","c1s","c2s","c3s","i","length","low","high","mid","Math","floor","xHere","max","diff","diffSq","indexes","push","sort","a","b","dys","dxs","ms","dx","dy","m2","mNext","dxNext","common","m","c1","invDx"],"mappings":"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"}