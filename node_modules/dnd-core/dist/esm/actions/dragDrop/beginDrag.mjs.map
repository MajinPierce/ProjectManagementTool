{"version":3,"sources":["../../../../src/actions/dragDrop/beginDrag.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\nimport type {\n\tAction,\n\tDragDropManager,\n\tXYCoord,\n\tBeginDragPayload,\n\tBeginDragOptions,\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n} from '../../interfaces.js'\nimport { setClientOffset } from './local/setClientOffset.js'\nimport { isObject } from '../../utils/js_utils.js'\nimport { BEGIN_DRAG, INIT_COORDS } from './types.js'\n\nconst ResetCoordinatesAction = {\n\ttype: INIT_COORDS,\n\tpayload: {\n\t\tclientOffset: null,\n\t\tsourceClientOffset: null,\n\t},\n}\n\nexport function createBeginDrag(manager: DragDropManager) {\n\treturn function beginDrag(\n\t\tsourceIds: Identifier[] = [],\n\t\toptions: BeginDragOptions = {\n\t\t\tpublishSource: true,\n\t\t},\n\t): Action<BeginDragPayload> | undefined {\n\t\tconst {\n\t\t\tpublishSource = true,\n\t\t\tclientOffset,\n\t\t\tgetSourceClientOffset,\n\t\t}: BeginDragOptions = options\n\t\tconst monitor = manager.getMonitor()\n\t\tconst registry = manager.getRegistry()\n\n\t\t// Initialize the coordinates using the client offset\n\t\tmanager.dispatch(setClientOffset(clientOffset))\n\n\t\tverifyInvariants(sourceIds, monitor, registry)\n\n\t\t// Get the draggable source\n\t\tconst sourceId = getDraggableSource(sourceIds, monitor)\n\t\tif (sourceId == null) {\n\t\t\tmanager.dispatch(ResetCoordinatesAction)\n\t\t\treturn\n\t\t}\n\n\t\t// Get the source client offset\n\t\tlet sourceClientOffset: XYCoord | null = null\n\t\tif (clientOffset) {\n\t\t\tif (!getSourceClientOffset) {\n\t\t\t\tthrow new Error('getSourceClientOffset must be defined')\n\t\t\t}\n\t\t\tverifyGetSourceClientOffsetIsFunction(getSourceClientOffset)\n\t\t\tsourceClientOffset = getSourceClientOffset(sourceId)\n\t\t}\n\n\t\t// Initialize the full coordinates\n\t\tmanager.dispatch(setClientOffset(clientOffset, sourceClientOffset))\n\n\t\tconst source = registry.getSource(sourceId)\n\t\tconst item = source.beginDrag(monitor, sourceId)\n\t\t// If source.beginDrag returns null, this is an indicator to cancel the drag\n\t\tif (item == null) {\n\t\t\treturn undefined\n\t\t}\n\t\tverifyItemIsObject(item)\n\t\tregistry.pinSource(sourceId)\n\n\t\tconst itemType = registry.getSourceType(sourceId)\n\t\treturn {\n\t\t\ttype: BEGIN_DRAG,\n\t\t\tpayload: {\n\t\t\t\titemType,\n\t\t\t\titem,\n\t\t\t\tsourceId,\n\t\t\t\tclientOffset: clientOffset || null,\n\t\t\t\tsourceClientOffset: sourceClientOffset || null,\n\t\t\t\tisSourcePublic: !!publishSource,\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction verifyInvariants(\n\tsourceIds: Identifier[],\n\tmonitor: DragDropMonitor,\n\tregistry: HandlerRegistry,\n) {\n\tinvariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.')\n\tsourceIds.forEach(function (sourceId) {\n\t\tinvariant(\n\t\t\tregistry.getSource(sourceId),\n\t\t\t'Expected sourceIds to be registered.',\n\t\t)\n\t})\n}\n\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset: any) {\n\tinvariant(\n\t\ttypeof getSourceClientOffset === 'function',\n\t\t'When clientOffset is provided, getSourceClientOffset must be a function.',\n\t)\n}\n\nfunction verifyItemIsObject(item: any) {\n\tinvariant(isObject(item), 'Item must be an object.')\n}\n\nfunction getDraggableSource(sourceIds: Identifier[], monitor: DragDropMonitor) {\n\tlet sourceId = null\n\tfor (let i = sourceIds.length - 1; i >= 0; i--) {\n\t\tif (monitor.canDragSource(sourceIds[i])) {\n\t\t\tsourceId = sourceIds[i]\n\t\t\tbreak\n\t\t}\n\t}\n\treturn sourceId\n}\n"],"names":["invariant","setClientOffset","isObject","BEGIN_DRAG","INIT_COORDS","ResetCoordinatesAction","type","payload","clientOffset","sourceClientOffset","createBeginDrag","manager","beginDrag","sourceIds","options","publishSource","getSourceClientOffset","monitor","getMonitor","registry","getRegistry","dispatch","verifyInvariants","sourceId","getDraggableSource","Error","verifyGetSourceClientOffsetIsFunction","source","getSource","item","undefined","verifyItemIsObject","pinSource","itemType","getSourceType","isSourcePublic","isDragging","forEach","i","length","canDragSource"],"mappings":"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"}