{"version":3,"sources":["../../../../src/actions/dragDrop/drop.ts"],"sourcesContent":["import { invariant } from '@react-dnd/invariant'\nimport type {\n\tAction,\n\tDragDropManager,\n\tDropPayload,\n\tDragDropMonitor,\n\tHandlerRegistry,\n\tIdentifier,\n} from '../../interfaces.js'\nimport { DROP } from './types.js'\nimport { isObject } from '../../utils/js_utils.js'\n\nexport function createDrop(manager: DragDropManager) {\n\treturn function drop(options = {}): void {\n\t\tconst monitor = manager.getMonitor()\n\t\tconst registry = manager.getRegistry()\n\t\tverifyInvariants(monitor)\n\t\tconst targetIds = getDroppableTargets(monitor)\n\n\t\t// Multiple actions are dispatched here, which is why this doesn't return an action\n\t\ttargetIds.forEach((targetId, index) => {\n\t\t\tconst dropResult = determineDropResult(targetId, index, registry, monitor)\n\t\t\tconst action: Action<DropPayload> = {\n\t\t\t\ttype: DROP,\n\t\t\t\tpayload: {\n\t\t\t\t\tdropResult: {\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\t...dropResult,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t\tmanager.dispatch(action)\n\t\t})\n\t}\n}\n\nfunction verifyInvariants(monitor: DragDropMonitor) {\n\tinvariant(monitor.isDragging(), 'Cannot call drop while not dragging.')\n\tinvariant(\n\t\t!monitor.didDrop(),\n\t\t'Cannot call drop twice during one drag operation.',\n\t)\n}\n\nfunction determineDropResult(\n\ttargetId: Identifier,\n\tindex: number,\n\tregistry: HandlerRegistry,\n\tmonitor: DragDropMonitor,\n) {\n\tconst target = registry.getTarget(targetId)\n\tlet dropResult = target ? target.drop(monitor, targetId) : undefined\n\tverifyDropResultType(dropResult)\n\tif (typeof dropResult === 'undefined') {\n\t\tdropResult = index === 0 ? {} : monitor.getDropResult()\n\t}\n\treturn dropResult\n}\n\nfunction verifyDropResultType(dropResult: any) {\n\tinvariant(\n\t\ttypeof dropResult === 'undefined' || isObject(dropResult),\n\t\t'Drop result must either be an object or undefined.',\n\t)\n}\n\nfunction getDroppableTargets(monitor: DragDropMonitor) {\n\tconst targetIds = monitor\n\t\t.getTargetIds()\n\t\t.filter(monitor.canDropOnTarget, monitor)\n\ttargetIds.reverse()\n\treturn targetIds\n}\n"],"names":["invariant","DROP","isObject","createDrop","manager","drop","options","monitor","getMonitor","registry","getRegistry","verifyInvariants","targetIds","getDroppableTargets","forEach","targetId","index","dropResult","determineDropResult","action","type","payload","dispatch","isDragging","didDrop","target","getTarget","undefined","verifyDropResultType","getDropResult","getTargetIds","filter","canDropOnTarget","reverse"],"mappings":"AAAA,MAAM,GAAGA,SAAS,QAAQ,CAAsB;AAShD,MAAM,GAAGC,IAAI,QAAQ,CAAY;AACjC,MAAM,GAAGC,QAAQ,QAAQ,CAAyB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAElD,MAAM,UAAUC,UAAU,CAACC,OAAwB,EAAE,CAAC;IACrD,MAAM,CAAC,QAAQ,CAACC,IAAI,CAACC,OAAO,GAAG,CAAC,CAAC,EAAQ,CAAC;QACzC,KAAK,CAACC,OAAO,GAAGH,OAAO,CAACI,UAAU;QAClC,KAAK,CAACC,QAAQ,GAAGL,OAAO,CAACM,WAAW;QACpCC,gBAAgB,CAACJ,OAAO;QACxB,KAAK,CAACK,SAAS,GAAGC,mBAAmB,CAACN,OAAO;QAE7C,EAAmF,AAAnF,iFAAmF;QACnFK,SAAS,CAACE,OAAO,EAAEC,QAAQ,EAAEC,KAAK,GAAK,CAAC;YACvC,KAAK,CAACC,UAAU,GAAGC,mBAAmB,CAACH,QAAQ,EAAEC,KAAK,EAAEP,QAAQ,EAAEF,OAAO;YACzE,KAAK,CAACY,MAAM,GAAwB,CAAC;gBACpCC,IAAI,EAAEnB,IAAI;gBACVoB,OAAO,EAAE,CAAC;oBACTJ,UAAU,oBACNX,OAAO,EACPW,UAAU;gBAEf,CAAC;YACF,CAAC;YACDb,OAAO,CAACkB,QAAQ,CAACH,MAAM;QACxB,CAAC;IACF,CAAC;AACF,CAAC;SAEQR,gBAAgB,CAACJ,OAAwB,EAAE,CAAC;IACpDP,SAAS,CAACO,OAAO,CAACgB,UAAU,IAAI,CAAsC;IACtEvB,SAAS,EACPO,OAAO,CAACiB,OAAO,IAChB,CAAmD;AAErD,CAAC;SAEQN,mBAAmB,CAC3BH,QAAoB,EACpBC,KAAa,EACbP,QAAyB,EACzBF,OAAwB,EACvB,CAAC;IACF,KAAK,CAACkB,MAAM,GAAGhB,QAAQ,CAACiB,SAAS,CAACX,QAAQ;IAC1C,GAAG,CAACE,UAAU,GAAGQ,MAAM,GAAGA,MAAM,CAACpB,IAAI,CAACE,OAAO,EAAEQ,QAAQ,IAAIY,SAAS;IACpEC,oBAAoB,CAACX,UAAU;IAC/B,EAAE,EAAE,MAAM,CAACA,UAAU,KAAK,CAAW,YAAE,CAAC;QACvCA,UAAU,GAAGD,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,GAAGT,OAAO,CAACsB,aAAa;IACtD,CAAC;IACD,MAAM,CAACZ,UAAU;AAClB,CAAC;SAEQW,oBAAoB,CAACX,UAAe,EAAE,CAAC;IAC/CjB,SAAS,CACR,MAAM,CAACiB,UAAU,KAAK,CAAW,cAAIf,QAAQ,CAACe,UAAU,GACxD,CAAoD;AAEtD,CAAC;SAEQJ,mBAAmB,CAACN,OAAwB,EAAE,CAAC;IACvD,KAAK,CAACK,SAAS,GAAGL,OAAO,CACvBuB,YAAY,GACZC,MAAM,CAACxB,OAAO,CAACyB,eAAe,EAAEzB,OAAO;IACzCK,SAAS,CAACqB,OAAO;IACjB,MAAM,CAACrB,SAAS;AACjB,CAAC"}