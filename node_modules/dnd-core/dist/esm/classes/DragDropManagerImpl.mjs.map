{"version":3,"sources":["../../../src/classes/DragDropManagerImpl.ts"],"sourcesContent":["import type { Store, Action } from 'redux'\nimport type { DragDropMonitorImpl } from './DragDropMonitorImpl.js'\nimport type { State } from '../reducers/index.js'\nimport type {\n\tActionCreator,\n\tBackend,\n\tDragDropActions,\n\tDragDropMonitor,\n\tDragDropManager,\n\tHandlerRegistry,\n} from '../interfaces.js'\nimport { createDragDropActions } from '../actions/dragDrop/index.js'\n\nexport class DragDropManagerImpl implements DragDropManager {\n\tprivate store: Store<State>\n\tprivate monitor: DragDropMonitor\n\tprivate backend: Backend | undefined\n\tprivate isSetUp = false\n\n\tpublic constructor(store: Store<State>, monitor: DragDropMonitor) {\n\t\tthis.store = store\n\t\tthis.monitor = monitor\n\t\tstore.subscribe(this.handleRefCountChange)\n\t}\n\n\tpublic receiveBackend(backend: Backend): void {\n\t\tthis.backend = backend\n\t}\n\n\tpublic getMonitor(): DragDropMonitor {\n\t\treturn this.monitor\n\t}\n\n\tpublic getBackend(): Backend {\n\t\treturn this.backend as Backend\n\t}\n\n\tpublic getRegistry(): HandlerRegistry {\n\t\treturn (this.monitor as DragDropMonitorImpl).registry\n\t}\n\n\tpublic getActions(): DragDropActions {\n\t\t/* eslint-disable-next-line @typescript-eslint/no-this-alias */\n\t\tconst manager = this\n\t\tconst { dispatch } = this.store\n\n\t\tfunction bindActionCreator(actionCreator: ActionCreator<any>) {\n\t\t\treturn (...args: any[]) => {\n\t\t\t\tconst action = actionCreator.apply(manager, args as any)\n\t\t\t\tif (typeof action !== 'undefined') {\n\t\t\t\t\tdispatch(action)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst actions = createDragDropActions(this)\n\n\t\treturn Object.keys(actions).reduce(\n\t\t\t(boundActions: DragDropActions, key: string) => {\n\t\t\t\tconst action: ActionCreator<any> = (actions as any)[\n\t\t\t\t\tkey\n\t\t\t\t] as ActionCreator<any>\n\t\t\t\t;(boundActions as any)[key] = bindActionCreator(action)\n\t\t\t\treturn boundActions\n\t\t\t},\n\t\t\t{} as DragDropActions,\n\t\t)\n\t}\n\n\tpublic dispatch(action: Action<any>): void {\n\t\tthis.store.dispatch(action)\n\t}\n\n\tprivate handleRefCountChange = (): void => {\n\t\tconst shouldSetUp = this.store.getState().refCount > 0\n\t\tif (this.backend) {\n\t\t\tif (shouldSetUp && !this.isSetUp) {\n\t\t\t\tthis.backend.setup()\n\t\t\t\tthis.isSetUp = true\n\t\t\t} else if (!shouldSetUp && this.isSetUp) {\n\t\t\t\tthis.backend.teardown()\n\t\t\t\tthis.isSetUp = false\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["createDragDropActions","DragDropManagerImpl","receiveBackend","backend","getMonitor","monitor","getBackend","getRegistry","registry","getActions","manager","dispatch","store","bindActionCreator","actionCreator","args","action","apply","actions","Object","keys","reduce","boundActions","key","isSetUp","handleRefCountChange","shouldSetUp","getState","refCount","setup","teardown","subscribe"],"mappings":"AAWA,MAAM,GAAGA,qBAAqB,QAAQ,CAA8B;AAEpE,MAAM,OAAOC,mBAAmB;IAYxBC,cAAc,CAACC,OAAgB,EAAQ,CAAC;QAC9C,IAAI,CAACA,OAAO,GAAGA,OAAO;IACvB,CAAC;IAEMC,UAAU,GAAoB,CAAC;QACrC,MAAM,CAAC,IAAI,CAACC,OAAO;IACpB,CAAC;IAEMC,UAAU,GAAY,CAAC;QAC7B,MAAM,CAAC,IAAI,CAACH,OAAO;IACpB,CAAC;IAEMI,WAAW,GAAoB,CAAC;QACtC,MAAM,CAAE,IAAI,CAACF,OAAO,CAAyBG,QAAQ;IACtD,CAAC;IAEMC,UAAU,GAAoB,CAAC;QACrC,EAA+D,AAA/D,2DAA+D,AAA/D,EAA+D,CAC/D,KAAK,CAACC,OAAO,GAAG,IAAI;QACpB,KAAK,CAAC,CAAC,CAACC,QAAQ,EAAC,CAAC,GAAG,IAAI,CAACC,KAAK;iBAEtBC,iBAAiB,CAACC,aAAiC,EAAE,CAAC;YAC9D,MAAM,KAAKC,IAAI,GAAY,CAAC;gBAC3B,KAAK,CAACC,MAAM,GAAGF,aAAa,CAACG,KAAK,CAACP,OAAO,EAAEK,IAAI;gBAChD,EAAE,EAAE,MAAM,CAACC,MAAM,KAAK,CAAW,YAAE,CAAC;oBACnCL,QAAQ,CAACK,MAAM;gBAChB,CAAC;YACF,CAAC;QACF,CAAC;QAED,KAAK,CAACE,OAAO,GAAGlB,qBAAqB,CAAC,IAAI;QAE1C,MAAM,CAACmB,MAAM,CAACC,IAAI,CAACF,OAAO,EAAEG,MAAM,EAChCC,YAA6B,EAAEC,GAAW,GAAK,CAAC;YAChD,KAAK,CAACP,MAAM,GAAwBE,OAAO,CAC1CK,GAAG;YAEFD,YAAY,CAASC,GAAG,IAAIV,iBAAiB,CAACG,MAAM;YACtD,MAAM,CAACM,YAAY;QACpB,CAAC,EACD,CAAC,CAAC;IAEJ,CAAC;IAEMX,QAAQ,CAACK,MAAmB,EAAQ,CAAC;QAC3C,IAAI,CAACJ,KAAK,CAACD,QAAQ,CAACK,MAAM;IAC3B,CAAC;gBApDkBJ,KAAmB,EAAEP,OAAwB,CAAE,CAAC;QAN7D,IAwEN,CApEQmB,OAAO,GAAG,KAAK;QAJjB,IAwEN,CAZQC,oBAAoB,OAAe,CAAC;YAC3C,KAAK,CAACC,WAAW,GAAG,IAAI,CAACd,KAAK,CAACe,QAAQ,GAAGC,QAAQ,GAAG,CAAC;YACtD,EAAE,EAAE,IAAI,CAACzB,OAAO,EAAE,CAAC;gBAClB,EAAE,EAAEuB,WAAW,KAAK,IAAI,CAACF,OAAO,EAAE,CAAC;oBAClC,IAAI,CAACrB,OAAO,CAAC0B,KAAK;oBAClB,IAAI,CAACL,OAAO,GAAG,IAAI;gBACpB,CAAC,MAAM,EAAE,GAAGE,WAAW,IAAI,IAAI,CAACF,OAAO,EAAE,CAAC;oBACzC,IAAI,CAACrB,OAAO,CAAC2B,QAAQ;oBACrB,IAAI,CAACN,OAAO,GAAG,KAAK;gBACrB,CAAC;YACF,CAAC;QACF,CAAC;QAhEA,IAAI,CAACZ,KAAK,GAAGA,KAAK;QAClB,IAAI,CAACP,OAAO,GAAGA,OAAO;QACtBO,KAAK,CAACmB,SAAS,CAAC,IAAI,CAACN,oBAAoB;IAC1C,CAAC"}